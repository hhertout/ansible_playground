---
- hosts: localhost
  connection: local
  become: false
  gather_facts: false
  environment: 
    K8S_AUTH_SSL_CA_CERT: "{{ lookup('file', 'cert/ca.crt') }}"
    K8S_AUTH_HOST: "{{ k8s_host }}"
    K8S_AUTH_API_KEY: "{{ k8s_token }}"
  vars:
    namespace: robsgbl0
    tls:
      cert_manager:
        issuer: letsencrypt-issuer
  pre_tasks:
    - name: Python kubernetes install
      ansible.builtin.pip:
        name: kubernetes
        executable: pip3

    - name: Get ca_cert cluster file
      ansible.builtin.set_fact:
        ca_cert: "{{ lookup('file', './cert/cluster_cert.txt') }}"

  roles:
    - role: alloy
    - role: mimir
    - role: loki
    - role: tempo
    - role: pyroscope
    - role: grafana